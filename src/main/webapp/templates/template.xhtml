<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css"
          rel="stylesheet"
          integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr"
          crossorigin="anonymous" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
            crossorigin="anonymous"></script>

    <link rel="stylesheet" href="https://unpkg.com/primeflex@latest/primeflex.css" />


    <h:outputStylesheet library="css" name="dark-style.css" />
</h:head>

<h:body>

    <div id="navbar">
        <ui:insert name="navbar">
            <ui:include src="/templates/navbar.xhtml" />
        </ui:insert>
    </div>

    <div id="content" style="padding-bottom: 80px">
        <br />
        <ui:insert name="content" />
        <br />
    </div>

    <ui:insert name="footer">
        <ui:include src="/templates/footer.xhtml" />
    </ui:insert>

   
    <h:form id="frmSyncDark">
        <p:remoteCommand name="rcSyncDark"
                         actionListener="#{temaBean.sincronizarModoOscuroDesdeCliente}"
                         update="@none" />
    </h:form>

 
    <script type="text/javascript">
    //<![CDATA[
      (function(){
      
        var DARK_CSS = "/* Activo SOLO cuando <body> tiene la clase .dark-mode */\
body.dark-mode { background-color:#1a1a1a !important; color:#f0f0f0 !important; }\
body.dark-mode .ui-widget, body.dark-mode .ui-widget-content { background-color:#1e1e1e !important; color:#f0f0f0 !important; border-color:#333 !important; }\
body.dark-mode .ui-widget-header { background-color:#2a2a2a !important; color:#f0f0f0 !important; border-color:#444 !important; }\
body.dark-mode .ui-inputtext, body.dark-mode .ui-inputfield, body.dark-mode input, body.dark-mode textarea, body.dark-mode select { background-color:#2b2b2b !important; color:#f0f0f0 !important; border-color:#444 !important; }\
body.dark-mode .ui-button, body.dark-mode .ui-button.ui-state-default { background-color:#444 !important; color:#f0f0f0 !important; border-color:#555 !important; }\
body.dark-mode .ui-button:hover, body.dark-mode .ui-button:focus { background-color:#555 !important; color:#fff !important; }\
body.dark-mode .ui-button.ui-button-outlined { background-color:transparent !important; color:orange !important; border-color:orange !important; }\
body.dark-mode .ui-menubar { background-color:#1a1a1a !important; border:1px solid #333 !important; color:#f0f0f0 !important; }\
body.dark-mode .ui-menubar .ui-menuitem-link, body.dark-mode .ui-menubar .ui-submenu-link { color:#f0f0f0 !important; }\
body.dark-mode .ui-menubar .ui-menuitem-link:hover, body.dark-mode .ui-menubar .ui-submenu-link:hover { background-color:#2b2b2b !important; }\
body.dark-mode .ui-menu-list { background-color:#1e1e1e !important; border:1px solid #444 !important; }\
body.dark-mode .ui-divider { border-color:#555 !important; }\
body.dark-mode .card { background:#1e1e1e !important; color:#f0f0f0 !important; border-color:#333 !important; }\
body.dark-mode .ui-datatable { background:#1e1e1e !important; }\
body.dark-mode .ui-datatable thead th { background:#2a2a2a !important; border-color:#444 !important; color:#f0f0f0 !important; }\
body.dark-mode .ui-datatable tbody td { border-color:#333 !important; }\
body.dark-mode .fixed-bottom-bar { background:#1e1e1e !important; color:#f0f0f0 !important; border-color:orange !important; }";

        function ensureInlineStyle() {
          if (!document.getElementById('dark-inline-style')) {
            var st = document.createElement('style');
            st.id = 'dark-inline-style';
            st.type = 'text/css';
            st.appendChild(document.createTextNode(DARK_CSS));
            document.head.appendChild(st);
          }
        }

        function removeInlineStyle() {
          var st = document.getElementById('dark-inline-style');
          if (st && st.parentNode) st.parentNode.removeChild(st);
        }

        window.aplicarTema = function(dark){
          document.body.classList.toggle('dark-mode', !!dark);
          if (dark) ensureInlineStyle(); else removeInlineStyle();
          try{ localStorage.setItem('darkMode', dark ? '1' : '0'); }catch(e){}
          
          if (typeof rcSyncDark === 'function') {
            try { rcSyncDark([{name:'clientDarkModeState', value: !!dark}]); } catch(e){}
          }
        };

        window.forzarToggleDark = function(){
          var dark = !document.body.classList.contains('dark-mode');
          window.aplicarTema(dark);
        };

       
        document.addEventListener('DOMContentLoaded', function(){
          var saved = false;
          try{ saved = localStorage.getItem('darkMode') === '1'; }catch(e){}
          window.aplicarTema(saved);
        });
      })();
    //]]>
    </script>
</h:body>
</html>
